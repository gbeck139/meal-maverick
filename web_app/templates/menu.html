{% extends 'base.html'%}

{%block head%}
  <title>Menu</title>

<style>

  .progress-container {
    width: 100%;
    background-color: #f3f3f3;
    border-radius: 5px;
    overflow: hidden;
    margin-top: 20px;
}

.progress-bar {
    height: 30px;
    width: 0;
    background-color: #4caf50;
    text-align: center;
    line-height: 30px; /* Center text vertically */
    color: white;
}
  
</style>

{%endblock%}
{%block body%}





<h1>Choose your meals</h1>
<h2>Here is where you can choose the meals you want for the week</h2>

  <div class="progress-container">
      <div id="progressBar" class="progress-bar">0%</div>
  </div>

<div>
<h1>Select Items</h1>
    <form id="mealForm" method="POST" action="/menu">
        {% for meal in meals %}
            <input type="checkbox" name="selected_meals" value="{{ meal.id }},{{meal.unit_price}}" id="meal{{ meal.id }}" onchange="toggleServings({{ meal.id }})"> {{ meal.name }}<br>
            <input type="number" id="servings{{ meal.id }}" name="servings{{ meal.id }}" min="1" value="{{meal.servings}}" style="width: 50px; display: none;"><br>
        {% endfor %}
        <button type="submit">Submit</button>
    </form>
</div>

<div class="contents">
  
</div>


<script>
    function toggleServings(mealId) {
        const servings = document.getElementById('servings' + mealId);
        const checkbox = document.getElementById('meal' + mealId);
        
        // Toggle the display of the servings input based on the checkbox state
        if (checkbox.checked) {
            servings.style.display = 'inline'; // Show servings input
            servings.textContent = " servings";
        } else {
            servings.style.display = 'none'; // Hide servings input
            servings.textContent = "";
        }
    }
</script>



    <script>
        // JavaScript to handle progress bar updates
        const mealForm = document.getElementById('mealForm');
        const progressBar = document.getElementById('progressBar');

        mealForm.addEventListener('change', function() {
            let totalValue = 0;

            // Calculate total value of selected meals based on servings
            const mealsChecked = document.querySelectorAll('input[name="selected_meals"]:checked');
            mealsChecked.forEach(meal => {
                
              const [id, unitPrice] = meal.value.split(',');
              // const id = meal.id    
              const unitPriceValue = parseFloat(unitPrice);
              const servingsId = 'servings'+id; // Get the corresponding servings input ID
              const servings = parseInt(document.getElementById(servingsId).value); // Get the number of servings
                
                totalValue += unitPriceValue * servings; // Multiply price by servings
            });

            // Assume maximum value for progress is $100 (can be adjusted)
            const maxValue = {{budget}};
            const percentage = (totalValue / maxValue) * 100;

            // Update progress bar
            progressBar.style.width = percentage + '%';
            progressBar.textContent = Math.round(percentage) + '%'; // Show percentage text
        });
    </script>


{%endblock%}
