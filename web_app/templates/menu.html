{% extends 'base.html'%}

{%block head%}
  <title>Menu</title>

<style>


  
  

</style>

{%endblock%}
{%block body%}





<h1>Choose your meals</h1>
<h2>Here is where you can choose the meals you want for the week</h2>


<div class = "data-container">
  <div class="progress-container-wrapper">
      <div class="progress-container">
          <div id="mealProgressBar" class="progress-bar">0%</div>
      </div>

      <div class="progress-container">
          <div id="timeProgressBar" class="progress-bar">0%</div>
      </div>

  </div>
  <p id="currentServings" class="number">0/{{servingsPerPerson}} meals planned</p>
</div>


<h1>Select Items</h1>
    <form id="mealForm" method="POST" action="/menu">
      <div style="  overflow-y: scroll; height: calc(50vh);">
        {% for meal in meals %}
            <input type="checkbox" id="meal{{ meal.id }}" name="selected_meals" value="{{ meal.id }}" data-price="{{meal.unit_price}}" data-time="{{meal.prep}}" onchange="toggleServings({{ meal.id }})"> {{ meal.name }} (${{meal.unit_price}})<br>
            <input type="number" id="servings{{ meal.id }}" name="servings{{ meal.id }}" min="1" max="{{totalServings}}" value="1" style="width: 50px; display: none;"><br>
        {% endfor %}
      </div>
        <button type="submit" style="margin-top: 10px;">Submit</button>
    </form>


<script src="../static/js/toggleServings.js"></script>



<script>
// JavaScript to handle progress bar updates
      const mealForm = document.getElementById('mealForm');
      const mealProgressBar = document.getElementById('mealProgressBar');
      const timeProgressBar = document.getElementById('timeProgressBar');
      const maxValue = {{budget}};
      const maxTime = {{time}};

  mealForm.addEventListener('change', function() {
      let totalValue = 0;
      let totalTime = 0;
      let totalServings = 0;

      // Calculate total value of selected meals based on servings
      const mealsChecked = document.querySelectorAll('input[name="selected_meals"]:checked');
      mealsChecked.forEach(meal => {

        const id = meal.value; 
        const unitPriceValue = parseFloat(meal.getAttribute("data-price"));
        const time = parseInt(meal.getAttribute("data-time"));
        const inputId = 'servings'+id; // Get the corresponding servings input ID
        const servings = parseInt(document.getElementById(inputId).value); // Get the number of servings

          totalValue += unitPriceValue * servings *{{people}}; // Multiply price by servings
          totalTime += time;
          totalServings += servings;
      });

      // Assume maximum value for progress is $100 (can be adjusted)
      const costPercentage = (totalValue / maxValue) * 100;
      const timePercentage = (totalTime/maxTime) * 100;

      // Update progress bar
      mealProgressBar.color = 
      mealProgressBar.style.width = costPercentage + '%';
      mealProgressBar.textContent = '$'+totalValue.toFixed(2); // Show percentage text
      timeProgressBar.style.width = timePercentage+'%';
      timeProgressBar.textContent = totalTime+' mins';
      document.getElementById('currentServings').textContent = totalServings+'/{{servingsPerPerson}} servings'
  });
</script>


{%endblock%}
